<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全格式文件预览工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
       .container {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #fileInput {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #666;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
        }
        #previewArea {
            margin-top: 20px;
            padding: 20px;
            border: 1px dashed #666;
            border-radius: 4px;
            min-height: 300px;
            text-align: center;
        }
       .file-info {
            color: #666;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 15px;
        }
       .file-type-tag {
            display: inline-block;
            padding: 3px 8px;
            background: #0d6efd;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
       .error {
            color: #dc3545;
            padding: 20px;
        }
        img, video, audio {
            max-width: 100%;
            max-height: 500px;
            margin: 10px auto;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 4px;
        }
        pre {
            text-align: left;
            white-space: pre-wrap;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: "Consolas", monospace;
        }
        audio {
            width: 100%;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>全格式文件预览工具</h2>
        <p>支持上传任意格式文件，自动识别并预览（部分格式需浏览器支持）</p>
        <input type="file" id="fileInput" accept="*">
        <div class="file-info" id="fileInfo"></div>
        <div id="previewArea">
            请选择文件进行预览...
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const previewArea = document.getElementById('previewArea');
        const fileInfo = document.getElementById('fileInfo');

        fileInput.addEventListener('change', handleFileUpload);

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                resetPreview();
                return;
            }

            // 提取文件信息
            const fileName = file.name;
            const fileSize = formatFileSize(file.size);
            const fileType = file.type || 'application/octet-stream';
            const ext = getFileExtension(fileName).toLowerCase();
            const typeDesc = getFileTypeDesc(ext, fileType);

            // 显示文件信息
            fileInfo.innerHTML = `
                文件名: ${fileName} 
                <span class="file-type-tag">${typeDesc}</span> | 
                大小: ${fileSize} | 
                MIME类型: ${fileType}
            `;

            // 根据文件类型调用对应预览方法
            if (fileType.startsWith('image/') || ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(ext)) {
                previewImage(file);
            } else if (fileType.startsWith('video/') || ['mp4', 'webm', 'mov', 'avi'].includes(ext)) {
                previewVideo(file);
            } else if (fileType.startsWith('audio/') || ['mp3', 'wav', 'ogg'].includes(ext)) {
                previewAudio(file);
            } else if (fileType === 'application/pdf' || ext === 'pdf') {
                previewPdf(file);
            } else if (fileType.startsWith('text/') || isTextExt(ext)) {
                previewText(file, ext);
            } else if (['doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'].includes(ext)) {
                previewOffice(file, ext);
            } else {
                // 无法直接预览的格式，显示文件信息
                previewUnknown(file);
            }
        }

        // 预览图片
        function previewImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewArea.innerHTML = `<img src="${e.target.result}" alt="${file.name}">`;
            };
            reader.onerror = () => showError('图片文件读取失败');
            reader.readAsDataURL(file);
        }

        // 预览视频
        function previewVideo(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewArea.innerHTML = `
                    <video controls>
                        <source src="${e.target.result}" type="${file.type}">
                        您的浏览器不支持该视频格式
                    </video>
                `;
            };
            reader.onerror = () => showError('视频文件读取失败');
            reader.readAsDataURL(file);
        }

        // 预览音频
        function previewAudio(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewArea.innerHTML = `
                    <audio controls>
                        <source src="${e.target.result}" type="${file.type}">
                        您的浏览器不支持该音频格式
                    </audio>
                `;
            };
            reader.onerror = () => showError('音频文件读取失败');
            reader.readAsDataURL(file);
        }

        // 预览PDF
        function previewPdf(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewArea.innerHTML = `<iframe src="${e.target.result}"></iframe>`;
            };
            reader.onerror = () => showError('PDF文件读取失败');
            reader.readAsDataURL(file);
        }

        // 预览文本/代码文件
        function previewText(file, ext) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewArea.innerHTML = `<pre>${e.target.result}</pre>`;
            };
            reader.onerror = () => showError('文本文件读取失败');
            reader.readAsText(file);
        }

        // 预览Office文件（提示无法直接预览）
        function previewOffice(file, ext) {
            previewArea.innerHTML = `
                <div class="error">
                    抱歉，.${ext}格式暂不支持直接预览。<br>
                    请保存文件后用对应软件打开（如Word、Excel、PowerPoint）。
                </div>
            `;
        }

        // 预览未知格式
        function previewUnknown(file) {
            previewArea.innerHTML = `
                <div>
                    该文件格式（.${getFileExtension(file.name)}) 暂不支持预览。<br>
                    文件大小: ${formatFileSize(file.size)}<br>
                    MIME类型: ${file.type || '未知'}
                </div>
            `;
        }

        // 辅助函数：获取文件扩展名
        function getFileExtension(filename) {
            const lastDotIndex = filename.lastIndexOf('.');
            return lastDotIndex > 0? filename.substring(lastDotIndex + 1) : '';
        }

        // 辅助函数：判断是否为文本扩展名
        function isTextExt(ext) {
            const textExts = ['txt', 'html', 'css', 'js', 'lua', 'py', 'json', 'xml', 'md', 'csv', ''];
            return textExts.includes(ext);
        }

        // 辅助函数：获取文件类型描述
        function getFileTypeDesc(ext, mimeType) {
            if (mimeType.startsWith('image/') || ['jpg', 'png', 'gif'].includes(ext)) return '图片';
            if (mimeType.startsWith('video/') || ['mp4', 'avi'].includes(ext)) return '视频';
            if (mimeType.startsWith('audio/') || ['mp3', 'wav'].includes(ext)) return '音频';
            if (mimeType === 'application/pdf' || ext === 'pdf') return 'PDF文档';
            if (isTextExt(ext)) return '文本/代码';
            if (['doc', 'docx'].includes(ext)) return 'Word文档';
            if (['xls', 'xlsx'].includes(ext)) return 'Excel表格';
            if (['ppt', 'pptx'].includes(ext)) return 'PPT演示文稿';
            return '未知类型';
        }

        // 辅助函数：格式化文件大小
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + 'B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + 'KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + 'MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + 'GB';
        }

        // 辅助函数：显示错误
        function showError(message) {
            previewArea.innerHTML = `<div class="error">${message}</div>`;
        }

        // 辅助函数：重置预览
        function resetPreview() {
            fileInfo.textContent = '';
            previewArea.innerHTML = '请选择文件进行预览...';
        }
    </script>
</body>
</html>
